language: node_js
node_js:
  - 14.15.0
cache:
  directories:
    - node_modules

jobs:
  include:
    - stage: build svelte mini app 🛠️
      before_script:
        - cd src/svelteComponents/github_repos_widget
        - npm ci
      script:
        - npm run build

    - stage: install main app deps 🌱
      before_script:
        - cd ~
      script:
        - npm ci

    - stage: generate service worker 🧰
      script:
        - npm run generate:serviceworker

    - stage: build eleventy app 🏗️
      script:
        - npm run build

    - stage: deploy to netlify 🚀
      before_deploy:
        - npm install netlify-cli -g
      deploy:
        provider: script
        edge: true
        script: netlify deploy --dir=dist --prod -site $NETLIFY_SITE_ID -auth $NETLIFY_ACCESS_TOKEN
        on:
          branch: master
